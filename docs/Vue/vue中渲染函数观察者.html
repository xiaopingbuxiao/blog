<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€… | å°å¹³ä¸å°</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="ä¸€ä¸ªå‰ç«¯æ”»åŸç‹®çš„å­¦ä¹ ç¬”è®°">
    <link rel="preload" href="/assets/css/0.styles.6ca259ee.css" as="style"><link rel="preload" href="/assets/js/app.4957a009.js" as="script"><link rel="preload" href="/assets/js/2.5b9869e2.js" as="script"><link rel="preload" href="/assets/js/11.6bcdbd2c.js" as="script"><link rel="preload" href="/assets/js/3.f51a2f18.js" as="script"><link rel="prefetch" href="/assets/js/10.ac23a092.js"><link rel="prefetch" href="/assets/js/12.1733108b.js"><link rel="prefetch" href="/assets/js/13.e4f4f2b6.js"><link rel="prefetch" href="/assets/js/14.4b2f2007.js"><link rel="prefetch" href="/assets/js/15.84a6ff1e.js"><link rel="prefetch" href="/assets/js/16.2566166b.js"><link rel="prefetch" href="/assets/js/17.b2a78d2a.js"><link rel="prefetch" href="/assets/js/18.2e18a722.js"><link rel="prefetch" href="/assets/js/19.55d8693d.js"><link rel="prefetch" href="/assets/js/20.e714aada.js"><link rel="prefetch" href="/assets/js/21.c5fa56df.js"><link rel="prefetch" href="/assets/js/22.90417807.js"><link rel="prefetch" href="/assets/js/23.5c31d834.js"><link rel="prefetch" href="/assets/js/24.8f99880c.js"><link rel="prefetch" href="/assets/js/25.5ecb582c.js"><link rel="prefetch" href="/assets/js/26.34fbc8b8.js"><link rel="prefetch" href="/assets/js/27.2ab72f50.js"><link rel="prefetch" href="/assets/js/28.3c669d05.js"><link rel="prefetch" href="/assets/js/29.abae87cf.js"><link rel="prefetch" href="/assets/js/30.fa48ac74.js"><link rel="prefetch" href="/assets/js/31.dac4d859.js"><link rel="prefetch" href="/assets/js/32.9869622b.js"><link rel="prefetch" href="/assets/js/4.018a88ef.js"><link rel="prefetch" href="/assets/js/5.acfa6a23.js"><link rel="prefetch" href="/assets/js/6.ef601a80.js"><link rel="prefetch" href="/assets/js/7.fac207cf.js"><link rel="prefetch" href="/assets/js/8.44809fb9.js"><link rel="prefetch" href="/assets/js/9.c0b509c0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6ca259ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">å°å¹³ä¸å°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯æ ˆ" class="dropdown-title"><span class="title">å‰ç«¯æ ˆ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/observer/object.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/promise.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/nodeJS/" class="nav-link">
  nodeJS
</a></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">
  å…³äºæˆ‘ä»¬
</a></div><div class="nav-item"><a href="https://github.com/xiaopingbuxiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯æ ˆ" class="dropdown-title"><span class="title">å‰ç«¯æ ˆ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/observer/object.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/promise.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/nodeJS/" class="nav-link">
  nodeJS
</a></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">
  å…³äºæˆ‘ä»¬
</a></div><div class="nav-item"><a href="https://github.com/xiaopingbuxiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/Vue/observer/object" class="sidebar-heading clickable open"><span>Vueçš„å“åº”å¼</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Vue/observer/object.html" class="sidebar-link">å¦‚ä½•å®ç°å¯¹å¯¹è±¡å˜åŒ–çš„ç›‘å¬</a></li><li><a href="/Vue/observer/array.html" class="sidebar-link">å¦‚ä½•å®ç°å¯¹æ•°ç»„å˜åŒ–çš„ç›‘å¬</a></li><li><a href="/Vue/observer/watch.html" class="sidebar-link">$watch çš„å®ç°</a></li><li><a href="/Vue/observer/set-delete.html" class="sidebar-link">vm.$set å’Œ vm.$delete</a></li><li><a href="/Vue/observer/computedçš„å®ç°.html" class="sidebar-link">vueä¸­computedçš„å®ç°</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vue/init/extend" class="sidebar-heading clickable"><span>Vueçš„init</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/Vue/vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€….html" class="active sidebar-link">vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€…</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Vue/vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€….html#ä¾èµ–çš„æ”¶é›†" class="sidebar-link">ä¾èµ–çš„æ”¶é›†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Vue/vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€….html#depæ”¶é›†watcherçš„è·¯çº¿" class="sidebar-link">depæ”¶é›†watcherçš„è·¯çº¿</a></li><li class="sidebar-sub-header"><a href="/Vue/vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€….html#ä¾èµ–æ”¶é›†è¿‡ç¨‹ä¸­çš„è¿‡æ»¤" class="sidebar-link">ä¾èµ–æ”¶é›†è¿‡ç¨‹ä¸­çš„è¿‡æ»¤</a></li></ul></li><li class="sidebar-sub-header"><a href="/Vue/vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€….html#è§¦å‘ä¾èµ–çš„è¿‡ç¨‹" class="sidebar-link">è§¦å‘ä¾èµ–çš„è¿‡ç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Vue/vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€….html#å¼‚æ­¥æ›´æ–°" class="sidebar-link">å¼‚æ­¥æ›´æ–°</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€…"><a href="#vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€…" class="header-anchor">#</a> vueä¸­æ¸²æŸ“å‡½æ•°è§‚å¯Ÿè€…</h1> <p>å¯¹äºç»„ä»¶ä¸­<code>render</code>å‡½æ•°çš„<code>watcher</code>çš„å®ä¾‹åŒ–æ˜¯åœ¨<code>beforeMount</code>ä¹‹åã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//core/instance/lifecycle.js</span>
<span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> updateComponent<span class="token punctuation">,</span> noop<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">before</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isMounted <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>_isDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeUpdate'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* isRenderWatcher */</span><span class="token punctuation">)</span>
</code></pre></div><p><code>vm._render</code>çš„æ‰§è¡Œç”¨æ¥ç”Ÿæˆ<code>vnode</code>ã€‚<code>vm._update</code>çš„æ‰§è¡Œä¼šå°†<code>vnode</code>ç”ŸæˆçœŸå®çš„<code>dom</code>ã€‚è¿™é‡Œå…ˆä¸åšæ·±ç©¶æ€ä¹ˆå®ç°ã€‚</p> <h2 id="ä¾èµ–çš„æ”¶é›†"><a href="#ä¾èµ–çš„æ”¶é›†" class="header-anchor">#</a> ä¾èµ–çš„æ”¶é›†</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ä¸Šé¢çš„æ¨¡ç‰ˆé€šè¿‡<code>Vue.complie</code>ç¼–è¯‘ä¹‹åç”Ÿæˆå¦‚ä¸‹çš„<code>render</code>å‡½æ•°ã€‚å³æ­¤æ—¶çš„<code>vm.render</code>å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“<code>updateComponent</code>å‡½æ•°çš„æ‰§è¡Œçš„æ—¶å€™ä¼šé—´æ¥çš„è§¦å‘<code>vm._render</code>çš„æ‰§è¡Œã€‚è€Œ<code>vm.render</code>çš„æ‰§è¡Œä¼šè§¦å‘<code>name</code>çš„ <code>get</code> æ“ä½œã€‚åœ¨æ­¤æ—¶æ•°æ®å·²ç»è¢«å¤„ç†ä¸ºäº†å“åº”å¼çš„ï¼Œå³<code>name</code>çš„<code>getter/setter</code>å·²ç»è¢«å¤„ç†ã€‚å› æ­¤è·å–<code>name</code>æ—¶è§¦å‘è‡ªèº«çš„ä¾èµ–æ”¶é›†ã€‚å°†æ­¤æ—¶çš„<code>watcher</code>æ”¶é›†åˆ°è‡ªèº«çš„<code>dep</code>ä¸­ã€‚</p> <h3 id="depæ”¶é›†watcherçš„è·¯çº¿"><a href="#depæ”¶é›†watcherçš„è·¯çº¿" class="header-anchor">#</a> depæ”¶é›†watcherçš„è·¯çº¿</h3> <p><code>dep</code>æ¥è¿›è¡Œæ”¶é›†å½“å‰çš„<code>watcher</code>è·¯çº¿å¯èƒ½æœ‰ç‚¹ç»•ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> value
<span class="token punctuation">}</span>
</code></pre></div><p>æ­¤æ—¶çš„<code>Dep.target</code>å°±æ˜¯æ¸²æŸ“å‡½æ•°çš„<code>watcher</code>å®ä¾‹ã€‚å› æ­¤è¿›å…¥<code>if</code>åˆ¤æ–­ã€‚æ‰§è¡Œ<code>dep.depend()</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Dep</span><span class="token punctuation">{</span>
  <span class="token function">depend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Watcher</span><span class="token punctuation">{</span>
  <span class="token comment">//....</span>
  <span class="token function">addDep</span> <span class="token punctuation">(</span><span class="token parameter">dep<span class="token operator">:</span> Dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç»•æ¥ç»•å»ã€‚æœ€ç»ˆåœ¨<code>Watcher</code>è¿›è¡Œæ”¶é›†çš„æ“ä½œã€‚æ­¤æ—¶çš„<code>dep</code>ä¾ç„¶æ˜¯<code>name</code>è‡ªèº«çš„<code>getter/setter</code>å½¢æˆé—­åŒ…å°è£…èµ·æ¥çš„<code>dep</code>ã€‚è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ï¼Œåœ¨<code>watcher</code>ä¸­è¿›è¡Œäº†è¿‡æ»¤çš„æ“ä½œï¼Œé¿å…é‡å¤æ”¶é›†åŒä¸€ä¸ªä¾èµ–ã€‚åŒæ—¶å¯ä»¥åšåˆ°ã€‚<code>dep</code>ä¸­æ”¶é›†éœ€è¦é€šçŸ¥çš„<code>watcher</code>ã€‚åŒæ—¶<code>watcher</code>ä¸­æ”¶é›†åˆ°éƒ½ä¼šè¢«è°æ‰€é€šçŸ¥(å‚¨å­˜åœ¨<code>watcher</code>è‡ªèº«çš„<code>deps</code>ä¸­)ã€‚</p> <h3 id="ä¾èµ–æ”¶é›†è¿‡ç¨‹ä¸­çš„è¿‡æ»¤"><a href="#ä¾èµ–æ”¶é›†è¿‡ç¨‹ä¸­çš„è¿‡æ»¤" class="header-anchor">#</a> ä¾èµ–æ”¶é›†è¿‡ç¨‹ä¸­çš„è¿‡æ»¤</h3> <p>ä¿®æ”¹ä¸Šé¢çš„<code>html</code>æ¨¡ç‰ˆå¦‚ä¸‹:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{name}}{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ç”Ÿæˆçš„æ¸²æŸ“å‡½æ•°å¦‚ä¸‹ã€‚æ­¤æ—¶éœ€è¦è§¦å‘ä¸¤æ¬¡<code>name</code>çš„<code>get</code>æ“ä½œã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">_s</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>æŒ‰ç…§ä¾èµ–æ”¶é›†çš„è·¯çº¿</strong>ã€‚åŒä¸€ä¸ªå±æ€§åªä¼šåœ¨è‡ªå·±çš„<code>getter/setter</code>çš„é—­åŒ…ä¸­ç”Ÿæˆä¸€ä¸ª<code>dep</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªå±æ€§çš„<code>dep.id</code>éƒ½æ˜¯å”¯ä¸€çš„ã€‚å› æ­¤å¯¹äºç¬¬äºŒæ¬¡çš„è·å–<code>name</code>æ—¶é¿å…æ‰äº†é‡å¤æ”¶é›†ï¼Œæ­¤æ—¶å°±å®Œæˆäº†åŒä¸€æ¬¡æ•°æ®å¤šæ¬¡è·å–æ—¶å€™çš„ä¾èµ–æ”¶é›†è¿‡æ»¤ã€‚</p> <p>åŒæ—¶<code>watcher</code>ä¸­ä½¿ç”¨<code>depsã€depIds</code>æ°¸è¿œä¿å­˜ç€ä¸Šæ¬¡æ•°æ®çš„<code>deps</code>ã€‚å½“<code>name</code>çš„æ•°æ®å˜åŒ–æ—¶è§¦å‘é‡æ–°è·å–çš„æ“ä½œæ—¶ï¼Œä¼šæ‹¿æœ€æ–°ä¸€æ¬¡æ•°æ®çš„<code>newDepIdsã€newDeps</code>ä¸ä¸Šä¸€æ¬¡çš„<code>deps</code>æ¥è¿›è¡Œå¯¹æ¯”ã€‚ä¸éœ€è¦çš„å°±åˆ é™¤ï¼Œéœ€è¦å¾—å°±ç»§ç»­æ·»åŠ ã€‚æ‰€ä»¥å¯¹äº<code>if (!this.depIds.has(id)) { dep.addSub(this) }</code>çš„ä½œç”¨å…¶å®å°±æ˜¯ï¼Œæ•°æ®å˜åŒ–å¤šæ¬¡æ±‚å€¼çš„æ—¶å€™é¿å…è°ƒé‡å¤æ”¶é›†ä¾èµ–ã€‚</p> <p>è·¯çº¿å›¾å¦‚ä¸‹ï¼š
<img src="/assets/img/vueRenderWatcher.ea0125c9.jpg" alt="ä¾èµ–æ”¶é›†çš„æµç¨‹"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Watcher</span><span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token function">addDep</span> <span class="token punctuation">(</span><span class="token parameter">dep<span class="token operator">:</span> Dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> value
    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// çœç•¥...</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token comment">// çœç•¥...</span>
      <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanupDeps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>
  <span class="token function">cleanupDeps</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>dep<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>depIds
    <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> tmp
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps
    <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> tmp
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="è§¦å‘ä¾èµ–çš„è¿‡ç¨‹"><a href="#è§¦å‘ä¾èµ–çš„è¿‡ç¨‹" class="header-anchor">#</a> è§¦å‘ä¾èµ–çš„è¿‡ç¨‹</h2> <p>åŠ å…¥æ¨¡ç‰ˆå¦‚ä¸‹ï¼›</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{name}}ä»Šå¹´{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">'#demo'</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'xiaopingbuxiao'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">18</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">dataChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'xiaoping'</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>åˆ™é€šè¿‡<code>Vue</code>ç¼–è¯‘ä¹‹åç”Ÿäº§çš„<code>render</code>å‡½æ•°å¦‚ä¸‹:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ä»Šå¹´&quot;</span> <span class="token operator">+</span> <span class="token function">_s</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ­¤æ—¶åœ¨<code>name</code>å’Œ<code>age</code>è‡ªèº«çš„<code>getter/setter</code>é—­åŒ…ä¸­çš„<code>dep</code>ä¸­éƒ½æ”¶é›†åˆ°äº†<code>render</code>å‡½æ•°ç”Ÿæˆçš„<code>watcher</code>ã€‚æ‰€ä»¥å½“<code>nameã€age</code>å˜åŒ–çš„æ—¶å€™ä¼šé€šçŸ¥<code>watcher</code>è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚</p> <p>åƒä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè°ƒç”¨<code>dataChange</code>å‡½æ•°åŒæ—¶æ”¹å˜äº†<code>nameã€age</code>ã€‚å¦‚æœåˆ†åˆ«é€šçŸ¥ä¸¤æ¬¡æ•°æ®å˜åŒ–ï¼Œ<code>watcher</code>éƒ½å»æ‰§è¡Œæ›´æ–°ç„¶åé‡æ–°æ¸²æŸ“çš„è¯æ˜¾ç„¶æ˜¯æ¯”è¾ƒè€—è´¹æ€§èƒ½çš„ã€‚å› æ­¤<code>Vue</code>æ˜¯ä¸ä¼šè¿™ä¹ˆåšçš„ï¼Œè€Œæ˜¯é€šè¿‡<strong>å¼‚æ­¥æ›´æ–°</strong>çš„ç­–ç•¥æ¥è¿›è¡Œå¤„ç†</p> <h3 id="å¼‚æ­¥æ›´æ–°"><a href="#å¼‚æ­¥æ›´æ–°" class="header-anchor">#</a> å¼‚æ­¥æ›´æ–°</h3> <p>é€šè¿‡ä¸Šé¢çŸ¥é“<code>nameã€age</code>çš„<code>deps</code>ä¸­éƒ½ä¼šæ”¶é›†åˆ°æ¸²æŸ“å‡½æ•°çš„<code>watcher</code>å®ä¾‹ã€‚å› æ­¤<code>nameã€age</code>å˜åŒ–æ—¶ï¼Œè§¦å‘æ›´æ–°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Watcher</span><span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cb<span class="token punctuation">,</span><span class="token string">'åŒæ­¥å½¢å¼'</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cb<span class="token punctuation">,</span><span class="token string">'é˜Ÿåˆ—å½¢å¼'</span><span class="token punctuation">)</span>
      <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯¹äºæ¸²æŸ“å‡½æ•°çš„<code>watcher</code>å®ä¾‹<code>this.lazy</code>ä¸º<code>false</code>(å…¶å®åªä¼šåœ¨<code>computed</code>ä¸­å±æ€§ä¸­ä¸º<code>true</code>)ã€‚åŒæ—¶<code>this.sync</code>ä¹Ÿä¸º<code>false</code>(åŒæ­¥æ›´æ–°çš„æ—¶å€™ä¸º<code>true</code>)ã€‚å› æ­¤å¯¹äºæ¸²æŸ“å‡½æ•°çš„<code>watcher</code>æ‰§è¡Œäº†<code>queueWatcher(this)</code>ã€‚å¦‚ä¸‹æ˜¯<code>queueWatcher</code>çš„å®ç°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//core/observer/scheduler.js</span>
<span class="token keyword">let</span> has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> waiting <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> flushing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span> <span class="token punctuation">(</span><span class="token parameter">watcher<span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
  <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// if already flushing, splice the watcher based on its id</span>
      <span class="token comment">// if already past its id, it will be run next immediately.</span>
      <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i<span class="token operator">--</span>
      <span class="token punctuation">}</span>
      queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// queue the flush</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      waiting <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span>async<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç»§ç»­æ‹¿ä¸Šé¢çš„ä¾‹å­ã€‚å½“<code>nameã€age</code>å˜åŒ–çš„æ—¶å€™ï¼Œå› æ­¤ä»–ä»¬è‡ªèº«éœ€è¦é€šçŸ¥çš„<code>watcher</code>æ˜¯åŒä¸€ä¸ªï¼Œé€šè¿‡<code>has</code>å¯¹è±¡ï¼Œé¿å…æ¸²æŸ“å‡½æ•°<code>watcher</code>å®ä¾‹å¤šæ¬¡çš„å…¥é˜Ÿã€‚åŒæ—¶å®šä¹‰äº†<code>flushing</code>ä¸€å¼€å§‹ä¸º<code>false</code>ä»£è¡¨å½“å‰è¿˜æ²¡æœ‰å¼€å§‹é˜Ÿåˆ—çš„æ›´æ–°ã€‚æ­¤æ—¶å¦‚æœæœ‰æ–°çš„<code>watcher</code>å…¥é˜Ÿç›´æ¥æ”¾åœ¨é˜Ÿåˆ—å°¾éƒ¨ã€‚å¦‚æœå·²ç»å¼€å§‹é˜Ÿåˆ—çš„æ›´æ–°ä¹‹åï¼Œåˆæœ‰æ–°çš„<code>watcher</code>å…¥é˜Ÿã€‚åˆ™åº”è¯¥ä¿è¯è§‚å¯Ÿè€…<code>watcher</code>çš„æ‰§è¡Œé¡ºåºã€‚</p> <p><strong>æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œæ‰€æœ‰çš„è§¦å‘<code>watcher</code>å…¥é˜Ÿçš„æ“ä½œéƒ½æ˜¯åœ¨å®ä»»åŠ¡ä¸­æ”¶é›†ï¼Œä½†æ˜¯é˜Ÿåˆ—çš„æ›´æ–°æ˜¯åœ¨<code>nextTick</code>çš„å¾®ä»»åŠ¡ä¸­è§¦å‘ï¼Œæ‰€ä»¥æ­¤å¤„æ²¡æœ‰æƒ³åˆ°ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šå‡ºç°<code>flushing===true</code>ä¹‹ååˆè¿›è¡Œäº†å…¥é˜Ÿçš„æ“ä½œã€‚è¿™é‡Œå¦‚æœæœ‰äº†è§£çš„å¤§ä½¬è¯·ç»™æˆ‘ç•™è¨€ï¼Œä¸èƒœæ„Ÿæ¿€ï¼Œè°¢è°¢è°¢è°¢ğŸ™</strong>ã€‚</p> <p><strong>åŒæ­¥æ›´æ–°</strong></p> <p>å¯¹äºä¸Šé¢æˆ‘ä»¬çŸ¥é“å¯¹äºæ¸²æŸ“å‡½æ•°çš„å¤„ç†ï¼Œæ˜¯é‡‡ç”¨çš„å¼‚æ­¥æ›´æ–°ç­–ç•¥,åŒæ ·å¯¹äºç”¨æˆ·çš„<code>watch</code>é»˜è®¤ä¹Ÿæ˜¯æ”¾å…¥é˜Ÿåˆ—å¼‚æ­¥æ›´æ–°çš„ã€‚ä½†æ˜¯å…¶å®æˆ‘ä»¬è‡ªå·±çš„<code>watch</code>æ˜¯å¯ä»¥è¿™ä¹ˆç©çš„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>watch<span class="token operator">:</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nameå‘ç”Ÿå˜åŒ–'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    sync<span class="token operator">:</span><span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¼ºåˆ¶æŒ‡å®š<code>watch</code>é‡‡ç”¨åŒæ­¥æ›´æ–°ã€‚åªæ˜¯å¯ä»¥è¿™ä¹ˆç©ï¼Œè¿„ä»Šä¸ºæ­¢å¹¶æ²¡æœ‰ç¢°åˆ°ä½¿ç”¨åœºæ™¯ï¼ŒåŒæ ·å¼ºçƒˆä¸æ¨èè¿™ä¹ˆç©</p> <p>æš‚æ—¶å…ˆä¸å»å…³å¿ƒ<code>nextTick</code>çš„å®ç°ï¼ŒæŠŠå®ƒå½“åšäº‹ä¸€ä¸ª<code>setTimeout</code>ç†è§£ã€‚ç»§ç»­çœ‹<code>flushSchedulerQueue</code>ï¼Œä¸éœ€è¦å…³æ³¨çš„å·²ç»åˆ é™¤äº†ï¼Œåªçœ‹ä¸‹é¢ä¸€éƒ¨åˆ†ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentFlushTimestamp <span class="token operator">=</span> <span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  flushing <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">let</span> watcher<span class="token punctuation">,</span> id
  
  queue<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    watcher <span class="token operator">=</span> queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>before<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// beforeUpdateå°±æ˜¯è¿™é‡Œ</span>
      watcher<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å…¶ä¸­ <code>queue</code>çš„æ’åºæ˜¯ä¸ºäº†ï¼š</p> <ol><li>Vueä¸­çš„ç»„ä»¶çš„åˆ›å»ºä¸æ›´æ–°æœ‰ç‚¹ç±»ä¼¼äºäº‹ä»¶æ•è·ï¼Œéƒ½æ˜¯ä»æœ€å¤–å±‚å‘å†…å±‚å»¶ä¼¸ï¼Œæ‰€ä»¥è¦å…ˆè°ƒç”¨çˆ¶ç»„ä»¶çš„åˆ›å»ºä¸æ›´æ–°</li> <li>userWatcheræ¯”renderWatcheråˆ›å»ºè¦æ—©ï¼Œè¿™ä»¶çš„ renderWatch æ°¸è¿œåœ¨æœ€å</li> <li>å¦‚æœçˆ¶ç»„ä»¶çš„watcherè°ƒç”¨runæ—¶å°†çˆ¶ç»„ä»¶å¹²æ‰äº†ï¼Œé‚£å…¶å­ç»„ä»¶çš„watcherä¹Ÿå°±æ²¡å¿…è¦è°ƒç”¨äº†</li></ol> <p>åŒæ—¶é€šè¿‡ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“<code>watch</code>è¿˜å¯ä»¥è¿™ä¹ˆç©ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>watch<span class="token operator">:</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nameå‘ç”Ÿå˜åŒ–'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nameå‘ç”Ÿæ”¹å˜ä¹‹å‰è§¦å‘'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// è¾“å‡º</span>
<span class="token comment">//nameå‘ç”Ÿæ”¹å˜ä¹‹å‰è§¦å‘</span>
<span class="token comment">//nameå‘ç”Ÿå˜åŒ–</span>
</code></pre></div><p>æ­¤ç¯‡æ–‡ç« æ›´å¤šçš„å€¾å‘äºè‡ªå·±çš„ç¬”è®°ï¼Œå¦‚æœæ‚¨æœ‰éœ€è¦å»ºè®®å¯¹ç…§<code>vue</code>æºç ä¸­<code>beforeMount</code>é’©å­ä¹‹å<code>render</code>å‡½æ•°å®ä¾‹åŒ–<code>watcher</code>å¤„å¼€å§‹ã€‚</p> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/Vue/init/Vueé€‰é¡¹çš„åˆå¹¶-ä¸Š.html" class="prev">
        Vueé€‰é¡¹çš„åˆå¹¶-ä¸Š
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4957a009.js" defer></script><script src="/assets/js/2.5b9869e2.js" defer></script><script src="/assets/js/11.6bcdbd2c.js" defer></script><script src="/assets/js/3.f51a2f18.js" defer></script>
  </body>
</html>
