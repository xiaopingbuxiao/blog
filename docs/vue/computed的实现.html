<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vueä¸­computedçš„å®ç° | å°å¹³ä¸å°</title>
    <meta name="description" content="ä¸€ä¸ªå‰ç«¯æ”»åŸç‹®çš„å­¦ä¹ ç¬”è®°">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.62a5f793.css" as="style"><link rel="preload" href="/assets/js/app.40be7466.js" as="script"><link rel="preload" href="/assets/js/2.0d8067bc.js" as="script"><link rel="preload" href="/assets/js/18.b0fa938a.js" as="script"><link rel="preload" href="/assets/js/3.14965ef8.js" as="script"><link rel="prefetch" href="/assets/js/10.6b37fe67.js"><link rel="prefetch" href="/assets/js/11.399c7dd5.js"><link rel="prefetch" href="/assets/js/12.d6c29194.js"><link rel="prefetch" href="/assets/js/13.8affd273.js"><link rel="prefetch" href="/assets/js/14.08ab3f0a.js"><link rel="prefetch" href="/assets/js/15.f694d3be.js"><link rel="prefetch" href="/assets/js/16.444f88b2.js"><link rel="prefetch" href="/assets/js/17.ffe6c8a4.js"><link rel="prefetch" href="/assets/js/19.6e7f6660.js"><link rel="prefetch" href="/assets/js/20.7d7a3423.js"><link rel="prefetch" href="/assets/js/21.ab4aae99.js"><link rel="prefetch" href="/assets/js/22.37f6eaa0.js"><link rel="prefetch" href="/assets/js/4.b884868f.js"><link rel="prefetch" href="/assets/js/5.9a76027c.js"><link rel="prefetch" href="/assets/js/6.91fdde54.js"><link rel="prefetch" href="/assets/js/7.befe6835.js"><link rel="prefetch" href="/assets/js/8.5f59229f.js"><link rel="prefetch" href="/assets/js/9.ed9cd60e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.62a5f793.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">å°å¹³ä¸å°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">å‰ç«¯æ ˆ</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/object.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/promise.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/nodeJS/" class="nav-link">nodeJS</a></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">å…³äºæˆ‘ä»¬</a></div><div class="nav-item"><a href="https://github.com/xiaopingbuxiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">å‰ç«¯æ ˆ</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/object.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/promise.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/nodeJS/" class="nav-link">nodeJS</a></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">å…³äºæˆ‘ä»¬</a></div><div class="nav-item"><a href="https://github.com/xiaopingbuxiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vue/object.html" class="sidebar-link">å¦‚ä½•å®ç°å¯¹å¯¹è±¡å˜åŒ–çš„ç›‘å¬</a></li><li><a href="/vue/array.html" class="sidebar-link">å¦‚ä½•å®ç°å¯¹æ•°ç»„å˜åŒ–çš„ç›‘å¬</a></li><li><a href="/vue/watch.html" class="sidebar-link">$watch çš„å®ç°</a></li><li><a href="/vue/set-delete.html" class="sidebar-link">vm.$set å’Œ vm.$delete</a></li><li><a href="/vue/computedçš„å®ç°.html" class="active sidebar-link">vueä¸­computedçš„å®ç°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/computedçš„å®ç°.html#computedçš„ä½¿ç”¨" class="sidebar-link">computedçš„ä½¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/vue/computedçš„å®ç°.html#computedçš„åˆå§‹åŒ–" class="sidebar-link">computedçš„åˆå§‹åŒ–</a></li><li class="sidebar-sub-header"><a href="/vue/computedçš„å®ç°.html#computedæ˜¯å¦‚ä½•å®ç°ç¼“å­˜çš„" class="sidebar-link">computedæ˜¯å¦‚ä½•å®ç°ç¼“å­˜çš„</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vueä¸­computedçš„å®ç°"><a href="#vueä¸­computedçš„å®ç°" aria-hidden="true" class="header-anchor">#</a> vueä¸­computedçš„å®ç°</h1> <h2 id="computedçš„ä½¿ç”¨"><a href="#computedçš„ä½¿ç”¨" aria-hidden="true" class="header-anchor">#</a> computedçš„ä½¿ç”¨</h2> <p>vueå®˜æ–¹æ–‡æ¡£ä¸­å¯¹äºcomputedçš„ä½¿ç”¨ä¸¾ä¾‹å¦‚ä¸‹ï¼›</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»…è¯»å–</span>
    <span class="token function-variable function">aDouble</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// è¯»å–å’Œè®¾ç½®</span>
    aPlus<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> v <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
vm<span class="token punctuation">.</span>aPlus   <span class="token comment">// =&gt; 2</span>
vm<span class="token punctuation">.</span>aPlus <span class="token operator">=</span> <span class="token number">3</span>
vm<span class="token punctuation">.</span>a       <span class="token comment">// =&gt; 2</span>
vm<span class="token punctuation">.</span>aDouble <span class="token comment">// =&gt; 4</span>
</code></pre></div><p><strong>è®¡ç®—å±æ€§æœ€å¤§çš„å¥½å¤„å°±æ˜¯å¯ä»¥ä»£æ›¿templateä¸­çš„è¡¨è¾¾å¼ã€‚</strong> å¦‚æœæˆ‘ä»¬åœ¨templateä¸­æ”¾å…¥å¤§é‡é€»è¾‘æ¯”è¾ƒå¤æ‚çš„è®¡ç®—æ—¶ï¼Œä¼šæ˜¯templateä¸­çš„é€»è¾‘è¿‡é‡ã€‚ä¼šå¯¹é¡µé¢çš„å¯ç»´æŠ¤æ€§é€ æˆå¾ˆå¤§çš„å½±å“ã€‚computedå®é™…çš„åˆè¡·å°±æ˜¯ä¸ºäº†ç»“å±€è¿™ç§é—®é¢˜ã€‚åŒæ—¶computedä¸­æœ‰å¾ˆå¤šå…¶ä»–çš„ä¼˜åŠ¿ï¼Œå…·ä½“å¦‚ä¸‹</p> <p><strong>computedçš„ä¼˜åŠ¿</strong></p> <ul><li>å‡å°‘templateä¸­çš„é€»è¾‘ï¼Œå¢åŠ é¡µé¢å¯ç»´æŠ¤æ€§</li> <li>computedçš„æ•°æ®ä¼šè¢«ç¼“å­˜</li> <li>computedçš„ä¸­çš„æ•°æ®åªæœ‰åœ¨ä½¿ç”¨æ—¶æ‰ä¼šè¢«è°ƒç”¨æ‰§è¡Œè®¡ç®—</li></ul> <p>é‚£ä¹ˆcomputedä¸­çš„æ˜¯å¦‚æœå®ç°çš„ï¼Œå·²ç»æ˜¯å¦‚ä½•è¢«ç¼“å­˜çš„å‘¢ï¼Ÿ ä¸‹é¢æ˜¯æˆ‘è‡ªå·±çš„ç†è§£ã€‚å¦‚æœæœ‰ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿æ”¯æŒğŸ™ã€‚</p> <h2 id="computedçš„åˆå§‹åŒ–"><a href="#computedçš„åˆå§‹åŒ–" aria-hidden="true" class="header-anchor">#</a> computedçš„åˆå§‹åŒ–</h2> <p>å¦‚æœä½ å¯¹äºvueæ•°æ®çš„å“åº”å¼å˜åŒ–å¦‚æœè¿˜ä¸ç†è§£ï¼Œå¯ä»¥çœ‹æˆ‘çš„å‰ä¸¤ç¯‡æ–‡ç«  <a href="https://xiaopingbuxiao.com/vue/object.html" target="_blank" rel="noopener noreferrer">å¦‚ä½•å®ç°å¯¹å¯¹è±¡å˜åŒ–çš„ç›‘å¬<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,<a href="https://xiaopingbuxiao.com/vue/array.html" target="_blank" rel="noopener noreferrer">å¦‚ä½•å®ç°å¯¹æ•°ç»„å˜åŒ–çš„ç›‘å¬<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</p> <p>è¨€å½’æ­£ä¼ ï¼Œå›åˆ°computedä¸Šé¢æ¥ï¼Œå…ˆæ¥çœ‹computedæ•°æ®çš„åˆå§‹åŒ–ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* core/instance/state.js */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span> <span class="token function">initMethods</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è°ƒç”¨initData å˜ä¸ºå“åº”å¼</span>
    <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//å¦‚æœæœ‰computed è§¦å‘computedæ•°æ®å¤„ç†</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>watch <span class="token operator">!==</span> nativeWatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>watch<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨ä¸Šé¢çš„æºç ä¸­çœ‹åˆ°ï¼ŒVue åœ¨ initState æ—¶è§¦å‘äº† initComputed è¿›è¡Œå¯¹ computed æ•°æ®å¤„ç†ï¼Œå†æ¥çœ‹ initComputed å‡½æ•°ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> computedWatcherOptions <span class="token operator">=</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">initComputed</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">:</span> Component<span class="token punctuation">,</span> computed<span class="token punctuation">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// $flow-disable-line</span>
  <span class="token keyword">const</span> watchers <span class="token operator">=</span> vm<span class="token punctuation">.</span>_computedWatchers <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token comment">// computed properties are just getters during SSR</span>
  <span class="token keyword">const</span> isSSR <span class="token operator">=</span> <span class="token function">isServerRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> userDef <span class="token operator">=</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">const</span> getter <span class="token operator">=</span> <span class="token keyword">typeof</span> userDef <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> userDef <span class="token punctuation">:</span> userDef<span class="token punctuation">.</span>get
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> getter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Getter is missing for computed property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//  vm._computedWatchers ä¸Šé¢å­˜æ”¾äº†æ‰€æœ‰çš„computedçš„watcher  å°†ç”¨æˆ·computedçš„æ¯ä¸€ä¸ªå±æ€§è¿›è¡Œä¸€ä¸ªè§‚å¯Ÿè€…çš„å®ä¾‹åŒ–</span>
    <span class="token comment">// åˆ†åˆ«ä¼ å…¥ vmå®ä¾‹  getterå‡½æ•° ä»¥åŠä¸€ä¸ªç©ºå‡½æ•° å’Œoptionså¸¸é‡ { lazy: true } / {computed:true}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSSR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>
        vm<span class="token punctuation">,</span>
        getter <span class="token operator">||</span> noop<span class="token punctuation">,</span>
        noop<span class="token punctuation">,</span>
        computedWatcherOptions
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * å¦‚æœæ˜¯å·²ç»å®šä¹‰åœ¨propsä¸­æˆ–è€…dataä¸­çš„æ•°æ® å¼€å‘ç¯å¢ƒè¿›è¡Œæé†’
     * å¦‚æœæ˜¯æ­£å¸¸æ•°æ®  å°±è¿›è¡Œä¸€ä¸ª defineComputed çš„æ“ä½œ
     * æ‰€ä»¥æ•´ä¸ªæµç¨‹è°ƒç”¨äº†ä¹‹åå°±åšåˆ°äº† å½“computedä¸­çš„å€¼è¢«ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šå»è§¦å‘è·å–å€¼çš„æ“ä½œ 
     * åŒæ—¶å°† dirtyç½®ä¸ºfalse
     */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">.</span>$data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The computed property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is already defined in data.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The computed property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is already defined as a prop.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢çš„ä»£ç é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ initComputed å‡½æ•°ä¹‹åã€‚è¿›è¡Œäº†ä¸€ä¸ªéå†æ“ä½œï¼Œéå†çš„è¿‡ç¨‹ä¸­å¦‚æœcomputedä¸­key å·²ç»åœ¨props æˆ–è€…dataä¸­å®šä¹‰è¿‡ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹å°±è¿›è¡Œä¸€ä¸ªæé†’ã€‚å¦åˆ™çš„è¯å°±è¿›è¡Œ defineComputed çš„æ“ä½œã€‚</p> <p><strong>æ³¨æ„ï¼švm._computedWatchers ä¸Šé¢æ”¶é›†äº†æ‰€æœ‰çš„computed ä¸­æ•°æ®çš„ watcherã€‚å¹¶ä¸”æ­¤æ—¶çš„ watcher æ¥å—çš„æœ€åä¸€ä¸ªå‚æ•°ä¸º { lazy: true }</strong>
å†æ¥çœ‹ä¸€ä¸‹ Watcher ç±»</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">:</span> Component<span class="token punctuation">;</span>
  expression<span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  cb<span class="token punctuation">:</span> Function<span class="token punctuation">;</span>
  id<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  deep<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  user<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  lazy<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  sync<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  dirty<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  active<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  deps<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Dep<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  newDeps<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Dep<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  depIds<span class="token punctuation">:</span> SimpleSet<span class="token punctuation">;</span>
  newDepIds<span class="token punctuation">:</span> SimpleSet<span class="token punctuation">;</span>
  before<span class="token punctuation">:</span> <span class="token operator">?</span>Function<span class="token punctuation">;</span>
  getter<span class="token punctuation">:</span> Function<span class="token punctuation">;</span>
  value<span class="token punctuation">:</span> any<span class="token punctuation">;</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span>
    <span class="token parameter">vm<span class="token punctuation">:</span> Component<span class="token punctuation">,</span>
    expOrFn<span class="token punctuation">:</span> string <span class="token operator">|</span> Function<span class="token punctuation">,</span>
    cb<span class="token punctuation">:</span> Function<span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
    isRenderWatcher<span class="token operator">?</span><span class="token punctuation">:</span> boolean</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRenderWatcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_watcher <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
    vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token comment">// options</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deep <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>deep
      <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>user
      <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>lazy
      <span class="token keyword">this</span><span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>sync
      <span class="token keyword">this</span><span class="token punctuation">.</span>before <span class="token operator">=</span> options<span class="token punctuation">.</span>before
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">++</span>uid <span class="token comment">// uid for batching</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token comment">// for lazy watchers</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>expression <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span>
      <span class="token operator">?</span> expOrFn<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token comment">// parse expression for getter</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> expOrFn <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> expOrFn
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> <span class="token function">parsePath</span><span class="token punctuation">(</span>expOrFn<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> noop
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed watching path: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expOrFn<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
          <span class="token string">'Watcher only accepts simple dot-delimited paths. '</span> <span class="token operator">+</span>
          <span class="token string">'For full control, use a function instead.'</span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœæ˜¯computedçš„æ•°æ®  è¿›è¡Œæƒ°æ€§æ±‚å€¼ å…ˆä¸è¿›è¡Œè°ƒç”¨ </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy
      <span class="token operator">?</span> <span class="token keyword">undefined</span>
      <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token comment">/**
     * å¦‚æœæ˜¯ lazyæ˜¯computedçš„æ—¶å€™ä¼ å…¥çš„å€¼ åŒæ—¶ lazy ç¬¬ä¸€æ¬¡ä¹Ÿæ˜¯å–å¾—lazyçš„å€¼
     * è·å–äº†computedä¸­keyçš„valueä¹‹å  ä¼šå°†dirtyçš„å€¼ç½®ä¸ºfalse è¯æ˜å·²ç»è¿›è¡Œä¸€ä¸ªè·å–å€¼çš„æ“ä½œ
     * æ­¤åå°†dirtyé‡æ–°ç½®ä¸ºtrue å¼€å…³ä½œç”¨
     */</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * Evaluate the value of the watcher.
   * This only gets called for lazy watchers.
   */</span>
  <span class="token function">evaluate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ— ç”¨çš„ä»£ç å·²ç»åˆ æ‰ï¼Œç°åœ¨åªå…³å¿ƒ computedçš„é€»è¾‘ã€‚<strong>å¦‚æœæ˜¯computedçš„å€¼ï¼Œæ˜¯æ²¡æœ‰åœ¨ constructor ä¸­è¿›è¡Œä¸€ä¸ªæ±‚å€¼çš„è¿‡ç¨‹çš„ã€‚åªæ˜¯ç½®ä¸ºäº† undefinedã€‚</strong></p> <p>å†æ¥çœ‹defineComputed çš„ä½œç”¨ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">:</span> noop
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineComputed</span> <span class="token punctuation">(</span>
  <span class="token parameter">target<span class="token punctuation">:</span> any<span class="token punctuation">,</span>
  key<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  userDef<span class="token punctuation">:</span> Object <span class="token operator">|</span> Function</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> shouldCache <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">isServerRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> userDef <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sharedPropertyDefinition<span class="token punctuation">.</span>get <span class="token operator">=</span> shouldCache  <span class="token comment">//åªåˆ†æä¸æ˜¯æœåŠ¡ç«¯æ¸²æŸ“    è®¾ç½®keyçš„get</span>
      <span class="token operator">?</span> <span class="token function">createComputedGetter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token punctuation">:</span> <span class="token function">createGetterInvoker</span><span class="token punctuation">(</span>userDef<span class="token punctuation">)</span>
    sharedPropertyDefinition<span class="token punctuation">.</span>set <span class="token operator">=</span> noop
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * ä¸‹é¢çš„ä¸‰ç›®è¿ç®— 
     */</span>
    <span class="token comment">// if(userDef.get){</span>
    <span class="token comment">//   if(shouldCache &amp;&amp; userDef.cache!==false){</span>
    <span class="token comment">//    sharedPropertyDefinition.get = createComputedGetter(key)</span>
    <span class="token comment">//   }else{</span>
    <span class="token comment">//     createGetterInvoker(userDef.get)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }else{</span>
    <span class="token comment">//   sharedPropertyDefinition.get = noop</span>
    <span class="token comment">// }</span>
    sharedPropertyDefinition<span class="token punctuation">.</span>get <span class="token operator">=</span> userDef<span class="token punctuation">.</span>get
      <span class="token operator">?</span> shouldCache <span class="token operator">&amp;&amp;</span> userDef<span class="token punctuation">.</span>cache <span class="token operator">!==</span> <span class="token boolean">false</span>
        <span class="token operator">?</span> <span class="token function">createComputedGetter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token function">createGetterInvoker</span><span class="token punctuation">(</span>userDef<span class="token punctuation">.</span>get<span class="token punctuation">)</span>
      <span class="token punctuation">:</span> noop
    sharedPropertyDefinition<span class="token punctuation">.</span>set <span class="token operator">=</span> userDef<span class="token punctuation">.</span>set <span class="token operator">||</span> noop
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
      sharedPropertyDefinition<span class="token punctuation">.</span>set <span class="token operator">===</span> noop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Computed property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; was assigned to but it has no setter.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token keyword">this</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createComputedGetter</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">computedGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ³¨æ„ï¼Œæ­¤æ—¶ createComputedGetter è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°†è¿™ä¸ªå‡½æ•°è®¾ç½®ä¸ºäº† computed ä¸­æ¯ä¸€ä¸ªå±æ€§key çš„getã€‚</p> <h2 id="computedæ˜¯å¦‚ä½•å®ç°ç¼“å­˜çš„"><a href="#computedæ˜¯å¦‚ä½•å®ç°ç¼“å­˜çš„" aria-hidden="true" class="header-anchor">#</a> computedæ˜¯å¦‚ä½•å®ç°ç¼“å­˜çš„</h2> <p>ç¬¬ä¸€æ¬¡è·å–computedä¸­çš„å±æ€§æ˜¯ watcher.dirty ä¸ºtrueã€‚å› æ­¤è°ƒç”¨äº† watcher.evaluate() å‡½æ•°ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">evaluate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ­¤æ—¶æ‰ä¼šè¿›è¡Œä¸€æ¬¡æ±‚å€¼çš„æ“ä½œã€‚è¿™ä¹Ÿå°±æ˜¯ ä¸ºä»€ä¹ˆ <strong>computedçš„ä¸­çš„æ•°æ®åªæœ‰åœ¨ä½¿ç”¨æ—¶æ‰ä¼šè¢«è°ƒç”¨æ‰§è¡Œè®¡ç®—</strong>ã€‚
ä¸Šé¢çš„ä»£ç ä¸­åŒæ—¶æ‰§è¡Œäº† this.dirty = falseã€‚</p> <p>å›åˆ°æœ€åˆçš„èµ·ç‚¹ï¼Œcomputedçš„ä½¿ç”¨</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä»…è¯»å–</span>
  <span class="token function-variable function">aDouble</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">*</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>aDouble ä¸­ä½¿ç”¨åˆ°äº† a è¿™ä¸ªæ•°æ®ï¼Œå› æ­¤açš„ depä¸­ä¼šæ”¶é›†åˆ° aDouble è¿™ä¸ªwatcher çš„ã€‚å› æ­¤å½“æ•°æ®a å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šçŸ¥ watcher è¿›è¡Œ updateçš„æ“ä½œå°† <strong>this.dirty = true</strong> ã€‚ä¸‹æ¬¡è·å–computedçš„å€¼çš„æ—¶å€™æ‰ä¼šè¿›è¡Œä¸€ä¸ªè®¡ç®—ã€‚å¦‚æœ a çš„å€¼ä¸€ç›´æ²¡æœ‰å˜åŒ–ã€‚é‚£ä¹ˆ aDouble è¿™ä¸ªwatcherä¸­çš„dirty ä¸€ç›´ä¸ºfalseï¼Œæ°¸è¿œä¸ä¼šè§¦å‘ watcher.evaluate() å‡½æ•°ã€‚<strong>è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„computedçš„æ•°æ®ä¼šè¢«ç¼“å­˜</strong></p> <p>çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœå†ç¢°åˆ°é¢è¯•å®˜é—®ä½  computedä¸­çš„æ•°æ®æ˜¯å¦‚ä½•å®ç°ç¼“å­˜çš„ æˆ–è€… computedå’Œwatcherçš„åŒºåˆ«æ—¶ï¼Œæˆ‘æƒ³ä½ å·²ç»çŸ¥é“è¯¥æ€ä¹ˆå¹ç‰›çš®äº†ï½</p> <p>ä»¥ä¸Šåªæ˜¯å±äºæˆ‘ä¸ªäººçš„ç†è§£æ•´ç†ï¼Œå¦‚æœæœ‰ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡å‡ºï¼Œè°¢è°¢ğŸ™</p> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/vue/set-delete.html" class="prev">
          vm.$set å’Œ vm.$delete
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.40be7466.js" defer></script><script src="/assets/js/2.0d8067bc.js" defer></script><script src="/assets/js/18.b0fa938a.js" defer></script><script src="/assets/js/3.14965ef8.js" defer></script>
  </body>
</html>
